<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Editing Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/js/all.min.js"></script>
    <style>
        @media (max-width: 768px) {
            .mobile-menu-active {
                overflow: hidden;
            }
        }

        .sidebar-open {
            transform: translateX(0) !important;
        }

        .sidebar-closed {
            transform: translateX(-100%);
        }

        @media (min-width: 768px) {
            .sidebar-closed {
                transform: translateX(0);
            }
        }

        @keyframes pulse-update {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 1;
            }
        }

        .updating {
            animation: pulse-update 1s ease-in-out infinite;
        }
    </style>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script type="text/javascript" src="https://ssl.gstatic.com/trends_nrtr/3461_RC01/embed_loader.js"></script>
    <script type="text/javascript" src="https://ssl.gstatic.com/trends_nrtr/3349_RC01/embed_loader.js"></script>
</head>

<body class="bg-gray-50">
    <div class="flex min-h-screen relative">
        <!-- Mobile Sidebar Overlay -->
        <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden hidden"></div>

        <!-- Sidebar -->
        <div id="sidebar"
            class="fixed md:sticky top-0 z-30 w-[80%] md:w-64 bg-white h-screen transition-transform duration-200 ease-in-out shadow-lg flex flex-col sidebar-closed">
            <!-- Header -->
            <div class="flex-shrink-0 flex items-center justify-between h-16 border-b px-4">
                <h1 class="text-xl font-bold text-indigo-600">Dashboard</h1>
                <button id="closeSidebar" class="md:hidden text-gray-500 p-2 rounded-lg hover:bg-gray-100">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <!-- Scrollable Navigation -->
            <nav class="flex-1 overflow-y-auto p-4 space-y-2 scrollbar-thin scrollbar-thumb-gray-300">
                <a data-page="home"
                    class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition-all">
                    <i class="fas fa-home w-5"></i>
                    <span class="ml-3">Home</span>
                </a>
                <a data-page="subscription"
                    class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition-all">
                    <i class="fas fa-credit-card w-5"></i>
                    <span class="ml-3">Subscription</span>
                </a>
                <a data-page="Videos"
                    class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition-all">
                    <i class="fa-solid fa-video"></i>
                    <span class="ml-3">Videos</span>
                </a>
                <a data-page="Packages"
                    class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition-all">
                    <i class="fa-solid fa-boxes-packing"></i>
                    <span class="ml-3">Packages</span>
                </a>
                <a data-page="Payments"
                    class="nav-link flex items-center px-4 py-3 text-gray-700 rounded-lg hover:bg-indigo-50 hover:text-indigo-600 transition-all">
                    <i class="fas fa-money-bills"></i>
                    <span class="ml-3">Payments</span>
                </a>
            </nav>
            <!-- Copyright Footer -->
            <div class="flex-shrink-0 p-4 border-t mt-auto">
                <p class="text-xs text-gray-500 text-center">ðŸ©· Designed by <a href="#"
                        class="hover:text-indigo-600 transition-all">Soumya Deb</a></p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col min-w-0">
            <!-- Header -->
            <header class="bg-white shadow-sm sticky top-0 z-10">
                <div class="flex items-center justify-between px-4 py-3 md:py-4">
                    <div class="flex items-center">
                        <button id="openSidebar" class="text-gray-500 md:hidden p-2 -ml-2">
                            <i class="fas fa-bars text-xl"></i>
                        </button>
                        <h1 id="pageTitle" class="text-lg font-semibold text-gray-800 md:hidden ml-2">Dashboard</h1>
                    </div>
                </div>
            </header>

            <!-- Content -->
            <main class="flex-1 p-3 md:p-6 overflow-y-auto">
                <div class="max-w-7xl mx-auto">
                    <!-- Home Page -->
                    <div id="homePage" class="page-content space-y-4 md:space-y-6">
                        <div class="flex justify-between items-center mb-4 md:mb-6">
                            <h1 class="text-xl md:text-2xl font-semibold text-gray-800 hidden md:block">Welcome Back!
                            </h1>
                            <div class="bg-blue-50 px-4 py-2 rounded-lg">
                                <span id="lastUpdated" class="text-sm text-blue-600"></span>
                            </div>
                        </div>

                        <!-- Stats Cards -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6">
                            <!-- Active Package Card -->
                            <div
                                class="bg-white rounded-lg shadow-sm p-3 md:p-6 transition-all hover:shadow-md bg-indigo-100">
                                <div class="flex items-center ">
                                    <div class="p-3 rounded-full text-indigo-600">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h2 class="text-sm font-medium text-gray-600">Active Package</h2>
                                        <p class="text-lg font-semibold text-gray-800" id="activePackage">Loading...</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Videos Count Card -->
                            <div
                                class="bg-white rounded-lg shadow-sm p-3 md:p-6 transition-all hover:shadow-md bg-green-100">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full text-green-600">
                                        <i class="fas fa-video"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h2 class="text-sm font-medium text-gray-600">Total Videos</h2>
                                        <p class="text-lg font-semibold text-gray-800" id="videoCount">Loading...</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Payment Status Card -->
                            <div
                                class="bg-white rounded-lg shadow-sm p-3 md:p-6 transition-all hover:shadow-md bg-yellow-100">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full  text-yellow-600">
                                        <i class="fas fa-money-bill"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h2 class="text-sm font-medium text-gray-600">Payment Due</h2>
                                        <p class="text-lg font-semibold text-gray-800" id="paymentStatus">Loading...</p>
                                    </div>
                                </div>
                            </div>
                            <!-- Days Left Card -->
                            <div
                                class="bg-white rounded-lg shadow-sm p-3 md:p-6 transition-all hover:shadow-md bg-red-100">
                                <div class="flex items-center">
                                    <div class="p-3 rounded-full  text-red-600">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="ml-4">
                                        <h2 class="text-sm font-medium text-gray-600">Days Left</h2>
                                        <p class="text-lg font-semibold text-gray-800" id="daysLeft">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Section -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                            <!-- Video Analytics -->
                            <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Video Performance</h2>
                                <div class="space-y-4" id="videoAnalytics">
                                    <div class="flex justify-between items-center p-3 bg-indigo-50 rounded-lg">
                                        <span class="text-sm text-gray-600">Average Duration</span>
                                        <span class="text-sm font-semibold text-indigo-600"
                                            id="avgDuration">--:--</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-green-50 rounded-lg">
                                        <span class="text-sm text-gray-600">Monthly Videos</span>
                                        <span class="text-sm font-semibold text-green-600" id="monthlyVideos">0</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-yellow-50 rounded-lg">
                                        <span class="text-sm text-gray-600">Video Types</span>
                                        <div class="flex gap-2">
                                            <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Long:
                                                <span id="longVideos">0</span></span>
                                            <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Short:
                                                <span id="shortVideos">0</span></span>
                                        </div>
                                    </div>
                                    <!-- New Analytics Items -->
                                    <div class="flex justify-between items-center p-3 bg-purple-50 rounded-lg">
                                        <span class="text-sm text-gray-600">Total Watch Time</span>
                                        <span class="text-sm font-semibold text-purple-600" id="totalWatchTime">0
                                            mins</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-pink-50 rounded-lg">
                                        <span class="text-sm text-gray-600">Content Categories</span>
                                        <div class="flex gap-2">
                                            <span class="text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded">Cooking:
                                                <span id="cookingVideos">0</span></span>
                                            <span class="text-xs bg-pink-100 text-pink-700 px-2 py-1 rounded">Vlogs:
                                                <span id="vlogVideos">0</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">

                                <!-- Search Section Container -->
                                <div class="bg-white shadow rounded-md p-3 md:p-4 w-full max-w-2xl border border-gray-200">
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <h1 class="text-base font-bold text-gray-900">YouTube Trends Search</h1>
                                            <div class="text-xs text-gray-500" id="last-updated"></div>
                                        </div>

                                        <!-- Search Form with Enhanced Layout -->
                                        <div class="flex flex-col sm:flex-row sm:items-end sm:space-x-3">
                                            <!-- Search Term Input with Validation -->
                                            <div class="w-full sm:flex-1 mb-2 sm:mb-0">
                                                <label for="search-term" class="block text-gray-700 text-xs font-medium mb-1">
                                                    Search Term <span class="text-red-500">*</span>
                                                </label>
                                                <div class="relative">
                                                    <input type="text" 
                                                           id="search-term" 
                                                           placeholder="Enter keyword to analyze" 
                                                           class="w-full p-2 border border-gray-300 rounded-md shadow-sm
                                                                  focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 
                                                                  text-sm transition-colors duration-200
                                                                  placeholder-gray-400"
                                                           aria-required="true"
                                                           aria-invalid="false">
                                                    <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none opacity-0 transition-opacity duration-200" id="search-icon">
                                                        <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Duration Dropdown with Enhanced UI -->
                                            <div class="w-full sm:w-32 mb-2 sm:mb-0">
                                                <label for="duration" class="block text-gray-700 text-xs font-medium mb-1">Time Range</label>
                                                <select id="duration"
                                                        class="w-full p-2 border border-gray-300 rounded-md shadow-sm
                                                               bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500
                                                               text-sm cursor-pointer appearance-none pr-8"
                                                        aria-label="Select time range">
                                                    <option value="1-H">Past hour</option>
                                                    <option value="4-H">Past 4 hours</option>
                                                    <option value="7-d">Past week</option>
                                                    <option value="1-m" selected>Past month</option>
                                                    <option value="3-m">Past 3 months</option>
                                                </select>
                                                <div class="relative">
                                                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none" style="margin-top: -30px;">
                                                        <svg class="h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Search Button with Loading State -->
                                            <div class="w-full sm:w-24">
                                                <button id="search-button"
                                                        class="w-full bg-indigo-600 text-white p-2 rounded-md
                                                               hover:bg-indigo-700 active:bg-indigo-800
                                                               focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500
                                                               text-sm font-medium transition-all duration-200
                                                               disabled:bg-gray-300 disabled:cursor-not-allowed
                                                               flex items-center justify-center space-x-2"
                                                        aria-label="Search trends">
                                                    <span>Search</span>
                                                    <div class="hidden" id="loading-spinner">
                                                        <svg class="animate-spin h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                                                        </svg>
                                                    </div>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Error Message with Animation -->
                                        <div id="error-message" 
                                             class="hidden text-red-600 text-xs bg-red-50 border border-red-200 rounded-md p-2 mt-2
                                                    transform transition-all duration-200 ease-in-out"
                                             role="alert">
                                        </div>
                                    </div>

                                    <!-- Error Message -->
                                    <div id="error-message" class="text-red-600 text-xs mt-2 sm:mt-1" role="alert">
                                    </div>
                                </div>

                                <!-- Trends Widget Container -->
                                <div id="trends-widget"
                                    class="mt-3 w-full max-w-2xl p-3 bg-white rounded-md shadow border border-gray-200">
                                </div>

                            </div>
                        </div>

                        <!-- Recent Activity and Quick Actions -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
                            <!-- Recent Activity -->
                            <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h2>
                                <div id="recentActivity" class="space-y-4">
                                    <!-- Activity items will be inserted here -->
                                </div>
                            </div>
                            <!-- Quick Actions -->
                            <div class="bg-white rounded-lg shadow-sm p-4 md:p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h2>
                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="document.querySelector('[data-page=\'Videos\']').click()"
                                        class="p-4 bg-indigo-50 rounded-lg hover:bg-indigo-100 transition-colors">
                                        <i class="fas fa-video text-indigo-600 text-xl mb-2"></i>
                                        <span class="block text-sm text-gray-700">View Videos</span>
                                    </button>
                                    <button onclick="document.querySelector('[data-page=\'Payments\']').click()"
                                        class="p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors">
                                        <i class="fas fa-money-bill text-green-600 text-xl mb-2"></i>
                                        <span class="block text-sm text-gray-700">View Payments</span>
                                    </button>
                                    <button onclick="document.querySelector('[data-page=\'Packages\']').click()"
                                        class="p-4 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors">
                                        <i class="fas fa-box text-yellow-600 text-xl mb-2"></i>
                                        <span class="block text-sm text-gray-700">View Packages</span>
                                    </button>
                                    <button onclick="(function() { 
                                        document.querySelector('[data-page=\'Packages\']').click(); 
                                        setTimeout(() => window.scrollTo(0, document.body.scrollHeight), 100);
                                    })()" class="p-4 bg-red-50 rounded-lg hover:bg-red-100 transition-colors">
                                        <i class="fas fa-headset text-red-600 text-xl mb-2"></i>
                                        <span class="block text-sm text-gray-700">Contact Support</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Subscription Page -->
                    <div id="subscriptionPage" class="page-content hidden space-y-4 md:space-y-6">
                        <div class="w-full space-y-4 md:space-y-6">
                            <!-- Current Subscription Card -->
                            <div class="bg-white rounded-lg shadow-sm p-3 md:p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">
                                    <i class="fas fa-clock text-indigo-600 mr-2"></i>
                                    Active Subscription
                                </h2>
                                <div id="currentSubscription">
                                    <div class="h-24 bg-gray-100 rounded-lg"></div>
                                </div>
                            </div>

                            <!-- Subscription History -->
                            <div x-data="{ showHistory: true }" class="bg-white rounded-lg shadow-sm p-3 md:p-6">
                                <div class="flex justify-between items-center mb-4 cursor-pointer md:cursor-default"
                                    @click="showHistory = !showHistory">
                                    <h2 class="text-lg font-semibold text-gray-800">
                                        <i class="fas fa-history text-indigo-600 mr-2"></i>
                                        Subscription History
                                    </h2>
                                    <i class="fas fa-chevron-down md:hidden transition-transform"
                                        x-bind:class="showHistory ? 'transform rotate-180' : ''"></i>
                                </div>
                                <div id="subscriptionHistory" class="space-y-4"
                                    x-bind:class="{ 'hidden': !showHistory, 'block': showHistory }">
                                    <div class="animate-pulse">
                                        <div class="h-24 bg-gray-100 rounded-lg"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Subscription Info -->
                            <div x-data="{ showBenefits: false }" class="bg-white rounded-lg shadow-sm p-3 md:p-6">
                                <div class="flex justify-between items-center mb-4 cursor-pointer md:cursor-default"
                                    @click="showBenefits = !showBenefits">
                                    <h2 class="text-mb font-semibold text-gray-800"><i
                                            class="fas fa-box-archive text-indigo-600 mr-2"></i> Package Benefits
                                    </h2>
                                    <i class="fas fa-chevron-down md:hidden transition-transform"
                                        x-bind:class="showBenefits ? 'transform rotate-180' : ''"></i>
                                </div>
                                <div class="space-y-3"
                                    x-bind:class="{ 'hidden': !showBenefits, 'block': showBenefits }">
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                        <span>24/7 Support</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                        <span>Priority Updates</span>
                                    </div>
                                    <div class="flex items-center text-sm text-gray-600">
                                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                        <span>Custom Features</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Packages Section -->
                    <section id="packagesContainer" class="hidden w-full">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <!-- Main Title -->
                            <div class="text-center mb-12">
                                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">
                                    <span
                                        class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-600">
                                        Our Packages
                                    </span>
                                </h1>
                                <p class="mt-4 text-xl text-gray-600">Choose the perfect package for your needs</p>
                            </div>

                            <!-- Main Packages -->
                            <div class="mb-16">
                                <div id="packages-container"
                                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                </div>
                            </div>

                            <!-- Single Edits Section -->
                            <div class="mb-16">
                                <div class="flex items-center mb-8">
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                    <h2 class="mx-4 text-2xl font-bold text-yellow-600">Single Edits</h2>
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                </div>
                                <div id="single-editing-container" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                </div>
                            </div>

                            <!-- Add-ons Section -->
                            <div class="mb-16">
                                <div class="flex items-center mb-8">
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                    <h2 class="mx-4 text-2xl font-bold text-green-600">Add-ons</h2>
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                </div>
                                <div id="add-ons-container"
                                    class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 hover:shadow-2xl transition-shadow duration-300">
                                </div>
                            </div>

                            <!-- Notes Section -->
                            <div class="mb-16">
                                <div class="flex items-center mb-8">
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                    <h2 class="mx-4 text-2xl font-bold text-indigo-600">Important Notes</h2>
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                </div>
                                <div class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6">
                                    <ul id="notes-container" class="space-y-3 text-gray-700 list-none">
                                    </ul>
                                </div>
                            </div>

                            <!-- Contact Section -->
                            <div class="mb-8">
                                <div class="flex items-center mb-8">
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                    <h2 class="mx-4 text-2xl font-bold text-indigo-600">Contact Us</h2>
                                    <div class="flex-grow h-px bg-gray-200"></div>
                                </div>
                                <div id="contact-container"
                                    class="bg-white rounded-2xl shadow-xl border border-gray-100 p-6 hover:shadow-2xl transition-shadow duration-300">
                                </div>
                            </div>
                        </div>
                    </section>
                    <!-- Videos Page -->
                    <div id="videosPage" class="page-content hidden space-y-4 md:space-y-6">
                        <div class="w-full max-w-5xl">
                            <h1 class="text-2xl font-bold text-gray-900 mb-6">Latest Videos</h1>

                            <!-- Video Container -->
                            <div id="video-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
                        </div>
                    </div>

                    <!-- Packages Page -->
                    <div id="packagesPage" class="page-content hidden mt-6 px-6">
                        <div class="container mx-auto p-6 w-full space-y-6">
                            <!-- Main Title -->
                            <h1 class="text-2xl font-bold text-gray-900">Our Packages</h1>

                            <!-- Packages Section -->
                            <div id="packages-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>

                            <!-- Single Edits Section -->
                            <section>
                                <h2
                                    class="text-xl font-bold bg-yellow-100 text-yellow-700 px-4 py-2 rounded-lg shadow mt-10">
                                    Single Edits
                                </h2>
                                <div id="single-editing-container" class="grid md:grid-cols-2 gap-6"></div>
                            </section>

                            <!-- Add-ons Section -->
                            <section>
                                <h2
                                    class="text-xl font-bold bg-green-100 text-green-700 px-4 py-2 rounded-lg shadow mt-10">
                                    Add-on
                                </h2>
                                <div id="add-ons-container"
                                    class="bg-white p-6 rounded-lg shadow-md border border-gray-200"></div>
                            </section>

                            <!-- Notes Section -->
                            <section>
                                <h2 class="text-xl font-semibold text-indigo-700 mt-10">Notes</h2>
                                <ul id="notes-container" class="list-disc pl-6 text-gray-700 space-y-2"></ul>
                            </section>

                            <!-- Contact Information Section -->
                            <section>
                                <h2 class="text-xl font-semibold text-indigo-700 mt-10">Contact Information</h2>
                                <div id="contact-container"
                                    class="bg-white p-6 rounded-lg shadow-md border border-gray-200"></div>
                            </section>
                        </div>
                    </div>



                    <!-- Summary Section -->
                    <div id="paymentsPage" class="page-content hidden space-y-4 md:space-y-6">
                        <div class="max-w-5xl mx-auto mt-6 p-4 bg-blue-50 rounded-lg shadow">
                            <h2 class="text-xl font-bold text-gray-800 mb-2">Summary</h2>
                            <p id="summaryText" class="text-gray-700"></p>
                        </div>
                        <br />

                        <!-- Current Package Card -->
                        <div id="currentPackageCard" class="max-w-5xl mx-auto mb-6"></div>

                        <!-- Completed Packages Breakdown -->
                        <div id="completedPackages" class="max-w-5xl mx-auto mb-6 space-y-4"></div>

                        <!-- Transactions Table -->
                        <div class="max-w-5xl mx-auto bg-white p-4 rounded-lg shadow">
                            <h2 class="text-xl font-bold text-gray-800 mb-4">All Transactions</h2>
                            <table class="w-full border-collapse border border-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="border border-gray-200 px-4 py-2 text-center">Date</th>
                                        <th class="border border-gray-200 px-4 py-2 text-center">Mode</th>
                                        <th class="border border-gray-200 px-4 py-2 text-center">Amount (â‚¹)</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsBody" class="bg-white"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebarOverlay');
            const openSidebarBtn = document.getElementById('openSidebar');
            const closeSidebarBtn = document.getElementById('closeSidebar');

            function openSidebar() {
                sidebar.classList.add('sidebar-open');
                sidebar.classList.remove('sidebar-closed');
                sidebarOverlay.classList.remove('hidden');
                document.body.classList.add('mobile-menu-active');
            }

            function closeSidebar() {
                sidebar.classList.remove('sidebar-open');
                sidebar.classList.add('sidebar-closed');
                sidebarOverlay.classList.add('hidden');
                document.body.classList.remove('mobile-menu-active');
            }

            openSidebarBtn.addEventListener('click', openSidebar);
            closeSidebarBtn.addEventListener('click', closeSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);

            // Handle touch swipe with error handling
            let touchStartX = 0;
            let touchEndX = 0;

            try {
                document.addEventListener('touchstart', e => {
                    touchStartX = e.changedTouches[0].screenX;
                }, { passive: true });

                document.addEventListener('touchend', e => {
                    touchEndX = e.changedTouches[0].screenX;
                    if (touchStartX - touchEndX > 50) {
                        closeSidebar();
                    }
                    if (touchEndX - touchStartX > 50) {
                        openSidebar();
                    }
                }, { passive: true });
            } catch (err) {
                console.error('Touch events failed:', err);
            }

            // Navigation handling with error checking
            const navLinks = document.querySelectorAll('nav a');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    try {
                        // Remove active class from all links
                        navLinks.forEach(l => l.classList.remove('bg-indigo-50', 'text-indigo-600'));
                        // Add active class to clicked link
                        link.classList.add('bg-indigo-50', 'text-indigo-600');
                        // Close sidebar on mobile
                        if (window.innerWidth < 768) {
                            closeSidebar();
                        }
                    } catch (err) {
                        console.error('Navigation error:', err);
                    }
                });
            });

            // Page Navigation with safety checks
            let currentPage = 'home';
            const pages = document.querySelectorAll('.page-content');
            const pageTitle = document.getElementById('pageTitle');

            function switchPage(pageName) {
                try {
                    currentPage = pageName;

                    // Hide all pages and sections first
                    document.querySelectorAll('.page-content, section').forEach(page => {
                        page.classList.add('hidden');
                    });

                    // Show the selected page
                    const pages = {
                        'home': 'Dashboard',
                        'subscription': 'Subscription',
                        'packages': 'Packages',
                        'videos': 'Videos',
                        'payments': 'Payments'
                    };

                    pageName = pageName.toLowerCase();
                    if (pageTitle) {
                        pageTitle.textContent = pages[pageName] || 'Dashboard';
                    }

                    // Safely show correct page
                    if (pageName === 'packages') {
                        const packagesContainer = document.getElementById('packagesContainer');
                        if (packagesContainer) {
                            packagesContainer.classList.remove('hidden');
                            loadPackages();
                        }
                    } else if (pageName === 'payments') {
                        const paymentsPage = document.getElementById('paymentsPage');
                        if (paymentsPage) {
                            paymentsPage.classList.remove('hidden');
                        }
                    } else if (pageName === 'Videos') {
                        const paymentsPage = document.getElementById('videosPage');
                        if (paymentsPage) {
                            paymentsPage.classList.remove('hidden');
                        }
                    } else {
                        const targetPage = document.getElementById(`${pageName}Page`);
                        if (targetPage) {
                            targetPage.classList.remove('hidden');
                        } else {
                            document.getElementById('homePage')?.classList.remove('hidden');
                        }
                    }

                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(link => {
                        if (link.dataset.page.toLowerCase() === pageName.toLowerCase()) {
                            link.classList.add('bg-indigo-50', 'text-indigo-600');
                        } else {
                            link.classList.remove('bg-indigo-50', 'text-indigo-600');
                        }
                    });
                } catch (err) {
                    console.error('Page switch error:', err);
                    // Fallback to home page
                    document.getElementById('homePage')?.classList.remove('hidden');
                }
            }

            // Add click handlers to nav links with error handling
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    try {
                        const page = e.currentTarget.dataset.page;
                        switchPage(page);
                        if (window.innerWidth < 768) {
                            closeSidebar();
                        }
                    } catch (err) {
                        console.error('Navigation click error:', err);
                    }
                });
            });

            // Initialize with home page
            switchPage('home');
        });

        let packageData = null;

        async function fetchAllData({ urlParams = '' } = {}) {
            try {
                const [subsResponse, packageResponse] = await Promise.all([
                    fetch(`https://raw.githubusercontent.com/abhraneel3/vEdits/main/active.json${urlParams}`),
                    fetch(`https://raw.githubusercontent.com/abhraneel3/vEdits/main/package.json${urlParams}`)
                ]);

                const subsData = await subsResponse.json();
                packageData = await packageResponse.json();

                updateSubscriptions(subsData);
            } catch (error) {
                console.error('Error fetching data:', error);
                showErrorState();
            }
        }

        function validateAddon(addon) {
            return addon === 'y' || addon === 'n' ? addon : 'n';
        }

        function calculateFinalRate(packageName, hasAddon, discount = '0', rate = null) {
            try {
                // Handle Single package type
                if (packageName === 'Single') {
                    // Get rate from input data or fallback to package data
                    const baseRate = rate ? parseInt(rate.replace(/[^\d]/g, '')) :
                        (packageData?.single_editing?.['Single']?.rate_initial ?
                            parseInt(packageData.single_editing.Single.rate_initial.replace(/[^\d]/g, '')) :
                            0);
                    const discountAmount = parseInt(discount) || 0;
                    const finalRate = Math.max(0, baseRate - discountAmount);
                    const validatedAddon = validateAddon(hasAddon);

                    return {
                        baseRate: `â‚¹${baseRate}`,
                        finalRate: `â‚¹${finalRate}`,
                        hasDiscount: discountAmount > 0,
                        isValidAddon: validatedAddon === 'y',
                        isSinglePackage: true,
                        description: "One video editing",
                        rateInfo: `â‚¹${baseRate} per video`
                    };
                }

                // Handle Shorts package type
                if (packageName === 'Shorts') {
                    // Get rate from package data or use provided rate
                    const baseRate = rate ? parseInt(rate.replace(/[^\d]/g, '')) : 200;
                    const validatedAddon = validateAddon(hasAddon);

                    // Add addon rate if applicable
                    let totalRate = baseRate;
                    if (validatedAddon === 'y' && packageData.add_on) {
                        const addonRate = parseInt(packageData.add_on.rate_initial.replace(/[^\d]/g, '')) || 0;
                        totalRate += addonRate;
                    }

                    const discountAmount = parseInt(discount) || 0;
                    const finalRate = Math.max(0, totalRate - discountAmount);

                    return {
                        baseRate: `â‚¹${totalRate}`,
                        finalRate: `â‚¹${finalRate}`,
                        hasDiscount: discountAmount > 0,
                        isValidAddon: validatedAddon === 'y',
                        isShortsPackage: true,
                        description: "Short form video editing",
                        rateInfo: `â‚¹${baseRate} per video`
                    };
                }

                // Handle regular packages
                if (!packageData?.packages?.[packageName]) return {
                    baseRate: 'â‚¹0',
                    finalRate: 'â‚¹0',
                    hasDiscount: false,
                    isValidAddon: false
                };

                const packageInfo = packageData.packages[packageName];
                const validatedAddon = validateAddon(hasAddon);

                // Get base rate from package
                let baseRate = parseInt(packageInfo.rate_initial.replace(/[^\d]/g, '')) || 0;

                // Add addon rate if applicable and package supports addons
                const isValidAddon = validatedAddon === 'y' && packageData.add_on && packageInfo.items.includes('Video');
                if (isValidAddon) {
                    const addonRate = parseInt(packageData.add_on.rate_initial.replace(/[^\d]/g, '')) || 0;
                    baseRate += addonRate;
                }

                // Calculate final rate after discount
                const discountAmount = parseInt(discount) || 0;
                const finalRate = Math.max(0, baseRate - discountAmount);

                return {
                    baseRate: `â‚¹${baseRate}`,
                    finalRate: `â‚¹${finalRate}`,
                    hasDiscount: discountAmount > 0,
                    isValidAddon
                };
            } catch (error) {
                console.error('Error calculating rate:', error);
                return {
                    baseRate: 'â‚¹0',
                    finalRate: 'â‚¹0',
                    hasDiscount: false,
                    isValidAddon: false,
                    isSinglePackage: false,
                    isShortsPackage: false
                };
            }
        }

        function updateSubscriptions(data) {
            if (!data?.Current) return;

            // Update Current Subscription
            const currentSub = data.Current;
            const packageDetails = packageData?.packages?.[currentSub.Package];
            const rates = calculateFinalRate(currentSub.Package, currentSub.addon, currentSub.disc);

            document.getElementById('currentSubscription').innerHTML = `
                <div class="bg-gradient-to-r from-indigo-50 to-blue-50 rounded-lg p-5 space-y-4 border border-indigo-100 shadow-sm">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
        <div class="w-full sm:w-auto text-center sm:text-left">
            <span class="text-xl font-bold text-indigo-700">${currentSub.Package}</span>
            <p class="text-sm text-gray-600 mt-1">${packageDetails?.items || ''}</p>
        </div>
        <div class="w-full sm:w-auto text-center sm:text-right">
            <span class="text-2xl font-bold text-green-600 block">${rates.finalRate}</span>

            ${rates.isValidAddon ? `
                <div class="text-xs text-gray-500 mt-1">
                    Base: ${packageDetails?.rate_initial} + Add-on: ${packageData?.add_on?.rate_initial}
                    ${rates.hasDiscount ? `<br>Discount: ${currentSub.disc}` : ''}
                </div>
                <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-md inline-block mt-1">+ Add-ons</span>
            ` : rates.hasDiscount ? `
                <span class="text-xs bg-green-50 text-green-700 px-2 py-1 rounded-md inline-block mt-2">Saved: â‚¹${currentSub.disc}</span>
            ` : ''}
        </div>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm border-t border-gray-200 pt-3 text-center sm:text-left">
        <div>
            <span class="text-gray-500 font-semibold">Start:</span>
            <span class="ml-2 text-gray-700 font-bold">${currentSub.start}</span>
        </div>
        <div>
            <span class="text-gray-500 font-semibold">End:</span>
            <span class="ml-2 text-gray-700 font-bold">${currentSub.end}</span>
        </div>
    </div>
</div> `;

            // Sort history items by date (most recent first)
            const sortedHistory = [...data.Completed].sort((a, b) => {
                const dateA = new Date(a.start.split('-').reverse().join('-'));
                const dateB = new Date(b.start.split('-').reverse().join('-'));
                return dateB - dateA;
            });

            // Update Subscription History
            const historyHTML = sortedHistory.map(sub => {
                const historyRates = calculateFinalRate(sub.Package, sub.addon, sub.disc, sub.rate);
                const historyPackage = packageData?.packages?.[sub.Package];

                return `
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200 shadow-sm transform transition-all hover:shadow-md">
    <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
        <div class="flex-1 text-center sm:text-left">
            <div class="flex flex-wrap items-center justify-center sm:justify-start gap-2 mb-1">
                <span class="font-semibold text-gray-900">${sub.Package}</span>

                ${historyRates.isShortsPackage ? `
                    <span class="text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded">Shorts</span>
                    ${historyRates.isValidAddon ? `<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">+ Add-ons</span>` : ''}
                ` : historyRates.isSinglePackage ? `
                    <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Single Edit</span>
                    ${historyRates.isValidAddon ? `<span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">+ Add-ons</span>` : ''}
                ` : historyRates.isValidAddon ? `
                    <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded">+ Add-ons</span>
                ` : ''}
            </div>
            <div class="text-xs text-gray-600">${sub.start} - ${sub.end}</div>
            ${historyRates.isShortsPackage ? `
                <div class="text-xs text-gray-500 mt-1">${historyRates.rateInfo}</div>
            ` : historyRates.isSinglePackage ? `
                <div class="text-xs text-gray-500 mt-1">${historyRates.description}</div>
            ` : ''}
        </div>
        <div class="sm:min-w-[150px] text-center sm:text-right">
            ${historyRates.hasDiscount ? `
                <span class="block text-sm line-through text-gray-400">${historyRates.baseRate}</span>
                <span class="block font-semibold text-green-700 text-lg">${historyRates.finalRate}</span>
                <span class="text-xs bg-green-50 text-green-700 px-2 py-1 rounded-md inline-block mt-1">Saved: â‚¹${sub.disc}</span>
            ` : `
                <span class="font-semibold text-gray-900 text-lg">${historyRates.finalRate}</span>
            `}
        </div>
    </div>
</div> `;
            }).join('');

            const historyContainer = document.getElementById('subscriptionHistory');
            if (data.Completed && data.Completed.length > 0) {
                historyContainer.innerHTML = historyHTML;
            } else {
                historyContainer.innerHTML = `
                    <div class="text-center py-6 text-gray-500">
                        <i class="fas fa-history text-gray-300 text-3xl mb-2"></i>
                        <p>No subscription history available</p>
                    </div>
                `;
            }
        }

        function showErrorState() {
            document.getElementById('currentSubscription').innerHTML =
                '<div class="text-red-500 p-4">Failed to load subscription data</div>';
            document.getElementById('subscriptionHistory').innerHTML =
                '<div class="text-red-500 p-4">Failed to load history data</div>';
        }

        // GitHub data sync functionality
        async function checkGitHubUpdates() {
            try {
                const timestamp = new Date().getTime();

                // Add updating animation
                const subscription = document.getElementById('currentSubscription').firstElementChild;
                if (subscription) {
                    subscription.classList.add('updating');
                }

                // Fetch with cache busting
                await fetchAllData({
                    urlParams: `?_=${timestamp}`
                });

                // Remove updating animation
                if (subscription) {
                    subscription.classList.remove('updating');
                }
            } catch (error) {
                console.error('Error checking updates:', error);
            }
        }

        async function startLiveDataFetching() {
            try {
                // Initial fetch
                await fetchAllData();

                // Set up polling interval
                fetchInterval = setInterval(async () => {
                    try {
                        await checkGitHubUpdates();
                    } catch (error) {
                        console.error('Error fetching data:', error);
                    }
                }, 5000); // Check every 5 seconds
            } catch (error) {
                console.error('Error in initial fetch:', error);
            }
        }

        // Live data fetching functionality
        let fetchInterval;
        let abortController;

        async function startLiveDataFetching() {
            try {
                await fetchAllData({ cache: 'no-store' });
                await checkGitHubUpdates();

                fetchInterval = setInterval(async () => {
                    abortController = new AbortController();
                    try {
                        await checkGitHubUpdates();
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            console.log('Fetch aborted');
                        } else {
                            console.error('Error fetching data:', error);
                        }
                    }
                }, 10000); // Changed from 20000 to 10000
            } catch (error) {
                console.error('Error in initial fetch:', error);
            }
        }

        function stopLiveDataFetching() {
            if (fetchInterval) {
                clearInterval(fetchInterval);
                fetchInterval = null;
            }
            if (abortController) {
                abortController.abort();
                abortController = null;
            }
        }

        // Update visibility handling
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                stopLiveDataFetching();
            } else {
                startLiveDataFetching();
            }
        });

        // Start live data fetching when the page loads
        document.addEventListener('DOMContentLoaded', startLiveDataFetching);

    </script>
    <script>
        async function loadPackages() {
            try {
                const response = await fetch("https://raw.githubusercontent.com/abhraneel3/vEdits/main/package.json"); // Change to actual path
                const data = await response.json();

                // Packages Section
                const packageContainer = document.getElementById("packages-container");
                packageContainer.innerHTML = Object.entries(data.packages).map(([key, pack]) => `
                    <div class="bg-white p-4 rounded-lg shadow-md border border-gray-200 transition duration-300 hover:shadow-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold text-indigo-600">${key}</h3>
                            <span class="bg-indigo-50 text-indigo-700 text-xs px-3 py-1 rounded-full">Package</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4">${pack.items}</p>
                        <div class="space-y-2 mb-4 text-sm text-gray-700">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-video text-indigo-500"></i>
                                <span>Long Videos: ${pack.long_video_count}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-mobile-alt text-indigo-500"></i>
                                <span>Basic Shorts: ${pack.basic_shorts_count}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-star text-indigo-500"></i>
                                <span>Creative Shorts: ${pack.creative_shorts_count}</span>
                            </div>
                        </div>
                        <div class="flex items-baseline gap-2 pt-3 border-t border-gray-100">
                            <span class="text-green-600 text-lg font-bold">${pack.rate_initial}</span>
                            <span class="text-gray-400 line-through text-sm">${pack.rate_revised}</span>
                        </div>
                    </div>
                `).join("");

                // Single Editing Section
                const singleEditingContainer = document.getElementById("single-editing-container");
                singleEditingContainer.innerHTML = Object.entries(data.single_editing).map(([key, edit]) => `
                    <div class="bg-white p-4 rounded-lg shadow-md border border-gray-200 transition duration-300 hover:shadow-lg">
                        <h3 class="text-lg font-bold text-indigo-600">${key} Editing</h3>
                        <p class="text-gray-600 text-sm mb-3">${edit.description}</p>
                        <div class="flex items-baseline gap-2">
                            <span class="text-green-600 text-lg font-bold">${edit.rate_initial}</span>
                            <span class="text-gray-400 line-through text-sm">${edit.rate_revised}</span>
                        </div>
                    </div>
                `).join("");

                // Add-ons Section
                const addOnsContainer = document.getElementById("add-ons-container");
                addOnsContainer.innerHTML = `
<h3 class="text-gray-700 text-sm mt-2 mb-4">${data.add_on.description}</h3>
<div class="flex items-center gap-3">
    <span class="text-green-600 text-lg font-bold">${data.add_on.rate_initial}</span>
</div>
`;

                // Notes Section
                const notesContainer = document.getElementById("notes-container");
                notesContainer.innerHTML = data.notes.map(note => `<li>${note}</li>`).join("");

                // Contact Section
                const contactContainer = document.getElementById("contact-container");
                contactContainer.innerHTML = `
                    <div class="flex flex-col space-y-4">
                        <h3 class="text-lg font-bold text-indigo-600 flex items-center gap-2">
                            <i class="fas fa-user-circle text-xl"></i>
                            ${data.contact.name}
                        </h3>
                        <div class="flex flex-col md:flex-row gap-4">
                            <a href="tel:${data.contact.phone}" class="flex items-center gap-3 bg-indigo-50 hover:bg-indigo-100 transition-colors rounded-lg px-4 py-2">
                                <i class="fas fa-phone text-indigo-500"></i>
                                <span class="text-gray-700">${data.contact.phone}</span>
                            </a>
                            <a href="mailto:${data.contact.email}" class="flex items-center gap-3 bg-indigo-50 hover:bg-indigo-100 transition-colors rounded-lg px-4 py-2">
                                <i class="fas fa-envelope text-indigo-500"></i>
                                <span class="text-gray-700">${data.contact.email}</span>
                            </a>
                        </div>
                    </div>`;
            } catch (error) {
                console.error("Error fetching JSON:", error);
            }
        }

        loadPackages();
    </script>
    <!--Payments section function-->
    <script>
        /**
         * Fetch data from a given URL and parse as JSON.
         */
        async function fetchData(url) {
            const response = await fetch(url);
            return response.json();
        }

        /**
         * Initializes the Payment Section:
         * 1) Fetch all JSON data
         * 2) Combine Completed & Current packages
         * 3) Calculate costs
         * 4) Allocate payments
         * 5) Render UI
         */
        async function initPaymentSection() {
            try {
                const [activeData, packageData, paymentData] = await Promise.all([
                    fetchData("https://raw.githubusercontent.com/abhraneel3/vEdits/main/active.json"),
                    fetchData("https://raw.githubusercontent.com/abhraneel3/vEdits/main/package.json"),
                    fetchData("https://raw.githubusercontent.com/abhraneel3/vEdits/main/payment.json")
                ]);

                // Combine Completed & Current packages in chronological order
                const allPackages = [...activeData.Completed, activeData.Current];

                // Calculate total cost for each package
                const packagesWithCost = allPackages.map(pkg => {
                    const baseRate = parseInt(pkg.rate.replace(/[â‚¹,]/g, "")) || 0;
                    const discount = parseInt(pkg.disc) || 0;
                    let addOnCost = 0;
                    if (pkg.addon === "y" && packageData.add_on) {
                        addOnCost = parseInt(packageData.add_on.rate_initial.replace(/[â‚¹,]/g, "")) || 0;
                    }
                    const totalCost = Math.max(0, baseRate - discount + addOnCost);
                    return { ...pkg, totalCost };
                });

                // Transactions array
                const transactions = paymentData.transactions || [];

                // Allocate payments to packages
                const packagesPaidData = allocatePayments(packagesWithCost, transactions);

                // The last item in packagesPaidData is the Current Package
                const currentPackage = packagesPaidData[packagesPaidData.length - 1];
                // The rest are Completed Packages
                const completedPackages = packagesPaidData.slice(0, -1);

                // Render the UI
                renderSummary(packagesPaidData);
                renderCurrentPackageCard(currentPackage);
                renderCompletedPackages(completedPackages);
                renderTransactions(transactions);

            } catch (error) {
                console.error("Error loading data:", error);
            }
        }

        /**
         * Allocates payments to each package in chronological order.
         */
        function allocatePayments(packageList, transactions) {
            // Clone to avoid mutating the original array
            const pkgs = packageList.map(p => ({ ...p }));
            // Convert transactions into numeric amounts
            const amounts = transactions.map(t => parseInt(t.amount) || 0);
            let amtIndex = 0;

            pkgs.forEach(pkg => {
                let costLeft = pkg.totalCost;
                let totalPaidForThisPkg = 0;

                while (costLeft > 0 && amtIndex < amounts.length) {
                    let payment = amounts[amtIndex];
                    if (payment > 0) {
                        if (payment >= costLeft) {
                            payment -= costLeft;
                            totalPaidForThisPkg += costLeft;
                            costLeft = 0;
                            amounts[amtIndex] = payment;
                        } else {
                            costLeft -= payment;
                            totalPaidForThisPkg += payment;
                            payment = 0;
                            amounts[amtIndex] = payment;
                        }
                    }
                    if (amounts[amtIndex] <= 0) {
                        amtIndex++;
                    }
                }

                pkg.paid = totalPaidForThisPkg;
                pkg.leftover = costLeft;
            });

            return pkgs;
        }

        /**
         * Renders the Summary at the top.
         */
        function renderSummary(pkgs) {
            const totalCost = pkgs.reduce((sum, p) => sum + p.totalCost, 0);
            const totalPaid = pkgs.reduce((sum, p) => sum + p.paid, 0);
            const totalLeftover = pkgs.reduce((sum, p) => sum + p.leftover, 0);

            const summaryEl = document.getElementById("summaryText");
            summaryEl.innerHTML = `
            <div class="w-full grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="p-3 bg-white rounded-lg shadow">
                <p class="text-gray-600">Total Cost</p>
                <p class="text-xl font-bold">â‚¹${totalCost}</p>
            </div>
            <div class="p-3 bg-white rounded-lg shadow">
                <p class="text-gray-600">Total Paid</p>
                <p class="text-xl font-bold text-green-600">â‚¹${totalPaid}</p>
            </div>
            <div class="p-3 bg-white rounded-lg shadow">
                <p class="text-gray-600">Remaining Due</p>
                <p class="text-xl font-bold ${totalLeftover > 0 ? 'text-red-600' : 'text-green-600'}">â‚¹${totalLeftover}</p>
            </div>
            </div>`;
        }

        /**
         * Renders the Current Package in the new style
         */
        function renderCurrentPackageCard(currentPkg) {
            const container = document.getElementById("currentPackageCard");
            const leftoverClass = currentPkg.leftover > 0 ? "text-red-600" : "text-green-600";

            container.innerHTML = `
            <div class="w-full bg-white p-4 rounded-lg shadow">
            <h2 class="text-lg font-bold text-gray-800 mb-4">Current Package</h2>
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div class="w-full md:w-auto">
                <h3 class="text-xl font-bold text-blue-700">${currentPkg.Package}</h3>
                <div class="grid grid-cols-2 gap-4 mt-2">
                    <p class="text-sm text-gray-600">Cost: â‚¹${currentPkg.totalCost}</p>
                    <p class="text-sm text-gray-600">Paid: <span class="text-green-600 font-semibold">â‚¹${currentPkg.paid}</span></p>
                </div>
                <p class="text-sm text-gray-500 mt-2">Period: ${currentPkg.start} to ${currentPkg.end}</p>
                </div>
                <div class="w-full md:w-auto text-right">
                <p class="text-lg font-semibold ${leftoverClass}">
                    Due: â‚¹${currentPkg.leftover}
                </p>
                </div>
            </div>
            </div>`;
        }

        /**
         * Renders the Completed Packages in the same style
         */
        function renderCompletedPackages(pkgs) {
            const container = document.getElementById("completedPackages");
            container.innerHTML = `
            <h2 class="text-lg font-bold text-gray-800 mb-4">Completed Packages</h2>
            <div class="grid gap-4">`;

            if (pkgs.length === 0) {
                container.innerHTML += `<p class="text-sm text-gray-600 p-4 bg-white rounded-lg shadow">No completed packages.</p>`;
                return;
            }

            // Sort packages by start date (most recent first)
            const sortedPkgs = [...pkgs].sort((a, b) => {
                const dateA = new Date(a.start.split('-').reverse().join('-'));
                const dateB = new Date(b.start.split('-').reverse().join('-'));
                return dateB - dateA;
            });

            sortedPkgs.forEach(pkg => {
                const leftoverClass = pkg.leftover > 0 ? "text-red-600" : "text-green-600";
                container.innerHTML += `
            <div class="w-full bg-white p-4 rounded-lg shadow">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div class="w-full md:w-auto">
                <h3 class="text-xl font-bold text-blue-700">${pkg.Package}</h3>
                <div class="grid grid-cols-2 gap-4 mt-2">
                <p class="text-sm text-gray-600">Cost: â‚¹${pkg.totalCost}</p>
                <p class="text-sm text-gray-600">Paid: <span class="text-green-600 font-semibold">â‚¹${pkg.paid}</span></p>
                </div>
                <p class="text-sm text-gray-500 mt-2">Period: ${pkg.start} to ${pkg.end}</p>
            </div>
            <div class="w-full md:w-auto text-right">
                <p class="text-lg font-semibold ${leftoverClass}">
                Due: â‚¹${pkg.leftover}
                </p>
            </div>
            </div>
            </div>`;
            });

            container.innerHTML += `</div>`;
        }

        /**
         * Renders the transactions in a responsive table
         */
        function renderTransactions(transactions) {
            // Sort transactions by date in descending order (most recent first)
            const sortedTransactions = [...transactions].sort((a, b) => {
                const dateA = new Date(a.date.split('-').reverse().join('-'));
                const dateB = new Date(b.date.split('-').reverse().join('-'));
                return dateB - dateA;
            });

            const tBody = document.getElementById("transactionsBody");
            const itemsPerPage = 3;
            let currentPage = 1;

            // Calculate total pages
            const totalPages = Math.ceil(sortedTransactions.length / itemsPerPage);

            function changePage(newPage) {
                if (newPage >= 1 && newPage <= totalPages) {
                    currentPage = newPage;
                    renderPage();
                }
            }

            // Function to render transactions for current page
            function renderPage() {
                const start = (currentPage - 1) * itemsPerPage;
                const end = start + itemsPerPage;
                const pageTransactions = sortedTransactions.slice(start, end);

                tBody.innerHTML = pageTransactions.map(tr => `
                <tr class="border-b border-gray-200 hover:bg-gray-50">
                <td class="px-4 py-3 text-center whitespace-nowrap">${tr.date}</td>
                <td class="px-4 py-3 text-center">${tr.mode}</td>
                <td class="px-4 py-3 font-semibold text-center text-gray-700">â‚¹${tr.amount}</td>
                </tr>
            `).join("");

                // Update pagination controls
                const paginationContainer = document.createElement('tr');
                const prevButton = document.createElement('button');
                const nextButton = document.createElement('button');

                paginationContainer.innerHTML = `
                <td colspan="3" class="px-4 py-3">
                <div class="flex items-center justify-center space-x-2">
                    <button id="prevPage"
                    class="px-3 py-1 rounded ${currentPage === 1 ? 'bg-gray-100 text-gray-400' : 'bg-indigo-500 text-white hover:bg-indigo-600'}"
                    ${currentPage === 1 ? 'disabled' : ''}>
                    Previous
                    </button>
                    <span class="text-gray-600">Page ${currentPage} of ${totalPages}</span>
                    <button id="nextPage"
                    class="px-3 py-1 rounded ${currentPage === totalPages ? 'bg-gray-100 text-gray-400' : 'bg-indigo-500 text-white hover:bg-indigo-600'}"
                    ${currentPage === totalPages ? 'disabled' : ''}>
                    Next
                    </button>
                </div>
                </td>
            `;
                tBody.appendChild(paginationContainer);

                // Add event listeners after adding to DOM
                document.getElementById('prevPage').addEventListener('click', () => changePage(currentPage - 1));
                document.getElementById('nextPage').addEventListener('click', () => changePage(currentPage + 1));
            }

            // Initial render
            renderPage();
        }

        // Initialize the Payment Section
        initPaymentSection();
    </script>
    <script>
        const videoContainer = document.getElementById("video-container");
        const API_URL = "https://raw.githubusercontent.com/abhraneel3/vEdits/main/video.json";

        // Extracts YouTube video ID from URL
        const extractYouTubeID = (url) => {
            const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|embed\/|v\/|.*[?&]v=))([^"&?/ ]{11})/);
            return match ? match[1] : null;
        };

        // Gets YouTube thumbnail with fallback
        const getYouTubeThumbnail = (videoID) =>
            videoID ? `https://img.youtube.com/vi/${videoID}/hqdefault.jpg` : "https://via.placeholder.com/320x180?text=No+Thumbnail";

        // Modern video card with glass morphism and animations
        const createVideoCard = ({ title, link, date, duration }) => {
            const videoID = extractYouTubeID(link);
            const thumbnailURL = getYouTubeThumbnail(videoID);

            return `
            <div class="group backdrop-blur-sm bg-white/30 rounded-xl shadow-lg overflow-hidden 
                        transform transition-all duration-300 hover:scale-[1.02] hover:shadow-2xl 
                        border border-gray-100/50">
                <div class="relative">
                    <!-- Thumbnail with overlay -->
                    <a href="${link}" class="block relative aspect-video overflow-hidden">
                        <img src="${thumbnailURL}" 
                             alt="${title}" 
                             class="w-full h-full object-cover transform transition-transform duration-500 group-hover:scale-110"/>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                            <div class="absolute bottom-4 left-4 right-4">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-black/50 text-white backdrop-blur-sm">
                                    <i class="fas fa-clock mr-2"></i>${duration}
                                </span>
                            </div>
                        </div>
                    </a>

                    <!-- Content -->
                    <div class="p-4">
                        <h2 class="text-lg font-semibold text-gray-800 line-clamp-2 mb-2 group-hover:text-indigo-600 transition-colors">
                            <a href="${link}">${title}</a>
                        </h2>
                        <div class="flex items-center space-x-3 text-sm text-gray-600">
                            <span class="flex items-center">
                                <i class="far fa-calendar-alt mr-2 text-indigo-500"></i>
                                ${date}
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-play-circle mr-2 text-indigo-500"></i>
                                Watch Now
                            </span>
                        </div>
                    </div>
                </div>
            </div>`;
        };

        // Enhanced loading and error states
        const fetchAndDisplayVideos = async () => {
            videoContainer.innerHTML = `
            <div class="col-span-full flex items-center justify-center p-12">
                <div class="relative">
                    <div class="h-24 w-24 rounded-full border-t-4 border-b-4 border-indigo-500 animate-spin"></div>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="h-16 w-16 rounded-full border-t-4 border-b-4 border-indigo-300 animate-spin"></div>
                    </div>
                </div>
            </div>`;

            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("Failed to fetch video data");

                const { video_creation: videos } = await response.json();
                if (!videos?.length) throw new Error("No videos available");

                const sortedVideos = videos.sort((a, b) => {
                    const dateA = new Date(a.date.split('-').reverse().join('-'));
                    const dateB = new Date(b.date.split('-').reverse().join('-'));
                    return dateB - dateA;
                });

                videoContainer.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-4";
                videoContainer.innerHTML = sortedVideos.map(createVideoCard).join("");

            } catch (error) {
                console.error("Error:", error);
                videoContainer.innerHTML = `
                <div class="col-span-full flex flex-col items-center justify-center p-12 text-center">
                    <div class="bg-red-50 rounded-full p-6 mb-4">
                        <i class="fas fa-exclamation-circle text-4xl text-red-500"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Oops! Something went wrong</h3>
                    <p class="text-gray-600 mb-6">${error.message}</p>
                    <button onclick="fetchAndDisplayVideos()" 
                            class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 text-white rounded-full
                                   hover:from-indigo-600 hover:to-purple-600 transform hover:scale-105 transition-all
                                   focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                        <i class="fas fa-redo mr-2"></i>Try Again
                    </button>
                </div>`;
            }
        };

        // Initialize
        fetchAndDisplayVideos();
    </script>
    <script>
        async function initializeHomePage() {
            try {
                const [activeData, videoData, paymentData, packageData] = await Promise.all([
                    fetch("https://raw.githubusercontent.com/abhraneel3/vEdits/main/active.json").then(r => r.json()),
                    fetch("https://raw.githubusercontent.com/abhraneel3/vEdits/main/video.json").then(r => r.json()),
                    fetch("https://raw.githubusercontent.com/abhraneel3/vEdits/main/payment.json").then(r => r.json()),
                    fetch("https://raw.githubusercontent.com/abhraneel3/vEdits/main/package.json").then(r => r.json())
                ]);

                // Update stats
                document.getElementById('activePackage').textContent = activeData.Current.Package;
                document.getElementById('videoCount').textContent = videoData.video_creation.length;

                // Calculate payment status using the payment section's logic
                const allPackages = [...activeData.Completed, activeData.Current];
                const packagesWithCost = allPackages.map(pkg => {
                    const baseRate = parseInt(pkg.rate.replace(/[â‚¹,]/g, "")) || 0;
                    const discount = parseInt(pkg.disc) || 0;
                    let addOnCost = 0;
                    if (pkg.addon === "y" && packageData.add_on) {
                        addOnCost = parseInt(packageData.add_on.rate_initial.replace(/[â‚¹,]/g, "")) || 0;
                    }
                    const totalCost = Math.max(0, baseRate - discount + addOnCost);
                    return { ...pkg, totalCost };
                });

                const transactions = paymentData.transactions || [];
                const packagesPaidData = allocatePayments(packagesWithCost, transactions);
                const totalLeftover = packagesPaidData.reduce((sum, p) => sum + p.leftover, 0);

                document.getElementById('paymentStatus').textContent = `â‚¹${totalLeftover}`;

                // Calculate days left
                const endDate = new Date(activeData.Current.end.split('-').reverse().join('-'));
                const today = new Date();
                const daysLeft = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
                document.getElementById('daysLeft').textContent = `${daysLeft} days`;

                // Update recent activity - sort by date first
                const recentActivity = document.getElementById('recentActivity');
                const sortedVideos = videoData.video_creation
                    .sort((a, b) => {
                        const dateA = new Date(a.date.split('-').reverse().join('-'));
                        const dateB = new Date(b.date.split('-').reverse().join('-'));
                        return dateB - dateA;
                    })
                    .slice(0, 3);

                recentActivity.innerHTML = sortedVideos.map(video => `
            <div class="flex items-center p-3 bg-gray-50 rounded-lg">
            <i class="fas fa-video text-indigo-600 mr-3"></i>
            <div>
                <p class="text-sm font-medium text-gray-800">${video.title}</p>
                <p class="text-xs text-gray-500">${video.date}</p>
            </div>
            </div>
        `).join('');

                // Update last updated time
                document.getElementById('lastUpdated').textContent = `Last updated: ${new Date().toLocaleString()}`;

                // Update analytics
                await updateAnalytics(videoData, activeData);

            } catch (error) {
                console.error('Error loading home page data:', error);
            }
        }

        // Call the function when the home page is shown
        document.addEventListener('DOMContentLoaded', () => {
            initializeHomePage();
            // Refresh data every 5 minutes
            setInterval(initializeHomePage, 300000);
        });

        async function updateAnalytics(videoData, activeData) {
            // Calculate average duration
            const durations = videoData.video_creation.map(v => {
                const [mins, secs] = v.duration.split(':').map(Number);
                return mins * 60 + secs;
            });
            const avgSeconds = Math.floor(durations.reduce((a, b) => a + b, 0) / durations.length);
            const avgMins = Math.floor(avgSeconds / 60);
            const avgSecs = avgSeconds % 60;
            document.getElementById('avgDuration').textContent =
                `${avgMins}:${avgSecs.toString().padStart(2, '0')}`;

            // Calculate monthly videos
            const currentMonth = new Date().getMonth();
            const monthlyCount = videoData.video_creation.filter(v => {
                const videoMonth = new Date(v.date.split('-').reverse().join('-')).getMonth();
                return videoMonth === currentMonth;
            }).length;
            document.getElementById('monthlyVideos').textContent = monthlyCount;

            // Count video types
            const longCount = videoData.video_creation.filter(v => {
                const [mins] = v.duration.split(':').map(Number);
                return mins >= 5;
            }).length;
            document.getElementById('longVideos').textContent = longCount;
            document.getElementById('shortVideos').textContent = videoData.video_creation.length - longCount;

            // Calculate total watch time
            const totalMinutes = durations.reduce((a, b) => a + b, 0) / 60;
            document.getElementById('totalWatchTime').textContent = `${Math.round(totalMinutes)} mins`;

            // Calculate video categories (example categories)
            const cookingCount = videoData.video_creation.filter(v =>
                v.title.toLowerCase().includes('recipe') ||
                v.title.toLowerCase().includes('thali') ||
                v.title.toLowerCase().includes('food') ||
                v.title.toLowerCase().includes('teasty') ||
                v.title.toLowerCase().includes('kitchen') ||
                v.title.toLowerCase().includes('cook')
            ).length;
            const vlogCount = videoData.video_creation.filter(v =>
                v.title.toLowerCase().includes('vlog') ||
                v.title.toLowerCase().includes('puja')
            ).length;

            document.getElementById('cookingVideos').textContent = cookingCount;
            document.getElementById('vlogVideos').textContent = vlogCount;
        }
    </script>

    <script type="text/javascript">
        // Predefined default data
        const defaultSearchTerm = "dish";
        const defaultDuration = "1-m";

        // Function to render the Google Trends widget
        function renderTrendsWidget(searchTerm, duration) {
            const widgetContainer = document.getElementById("trends-widget");
            const errorMessage = document.getElementById("error-message");
            const searchButton = document.getElementById("search-button");

            // Disable button during fetch
            searchButton.disabled = true;
            searchButton.textContent = "Loading...";

            // Validate search term
            if (!searchTerm || searchTerm.trim().length === 0) {
                errorMessage.textContent = "Please enter a valid search term";
                searchButton.disabled = false;
                searchButton.textContent = "Search";
                return;
            }
            errorMessage.textContent = "";

            // Map duration to Google Trends time format
            let timeParam;
            if (["1-H", "4-H", "7-d"].includes(duration)) {
                timeParam = "now " + duration;
            } else if (["1-m", "3-m"].includes(duration)) {
                timeParam = "today " + duration;
            } else {
                errorMessage.textContent = "Invalid duration selected.";
                searchButton.disabled = false;
                searchButton.textContent = "Search";
                return;
            }

            // Construct the exploreQuery
            const dateParam = timeParam.replace(" ", "%20");
            const exploreQuery = `date=${dateParam}&geo=IN&gprop=youtube&q=${encodeURIComponent(searchTerm)}&hl=en-US`;

            // Clear previous widget
            widgetContainer.innerHTML = "";

            // Render the widget
            try {
                trends.embed.renderExploreWidgetTo(widgetContainer, "TIMESERIES", {
                    "comparisonItem": [{
                        "keyword": searchTerm,
                        "geo": "IN",
                        "time": timeParam
                    }],
                    "category": 0,
                    "property": "youtube"
                }, {
                    "exploreQuery": exploreQuery,
                    "guestPath": "https://trends.google.com:443/trends/embed/"
                });
            } catch (error) {
                errorMessage.textContent = "Failed to load trends data. Please try again.";
                console.error("Error rendering trends widget:", error);
            } finally {
                searchButton.disabled = false;
                searchButton.textContent = "Search";
            }
        }

        // On page load, display the widget with default data
        document.addEventListener("DOMContentLoaded", function () {
            const searchInput = document.getElementById("search-term");
            searchInput.value = defaultSearchTerm;
            document.getElementById("search-button").disabled = false;
            renderTrendsWidget(defaultSearchTerm, defaultDuration);
        });

        // On "Search" button click, update the widget with new data
        document.getElementById("search-button").addEventListener("click", function () {
            const searchTerm = document.getElementById("search-term").value.trim();
            const duration = document.getElementById("duration").value;
            renderTrendsWidget(searchTerm, duration);
        });
    </script>

</body>

</html>
